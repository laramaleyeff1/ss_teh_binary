W_k_b = sample(W_k)
mean(Y_ki[W_k==1]) - mean(Y_ki[W_k==0])
Y_ki_b = Y_ki - 5*W_k + 5*W_k_b
mean(Y_ki_b[W_k_b==1]) - mean(Y_ki_b[W_k_b==0])
W_k <- rep(c(0,1),each=100)
Y_ki = 10*W_k + rnorm(100)
summary(lm(Y_ki ~ W_k))
W_k_b = sample(W_k)
mean(Y_ki[W_k==1]) - mean(Y_ki[W_k==0])
# obs difference is 10
Y_ki_b = Y_ki - 5*W_k + 5*W_k_b
mean(Y_ki_b[W_k_b==1]) - mean(Y_ki_b[W_k_b==0])
compute_statistic <- function(Y, W) {
Y1 = Y[W==1]
Y0 = Y[W==0]
Y1.star   = Y1 - mean(Y1)
Y0.star   = Y0 - mean(Y0)
unique.points = c(Y1.star, Y0.star)
Fn1 = ecdf(Y1.star)
Fn0 = ecdf(Y0.star)
difference = Fn1(unique.points) - Fn0(unique.points)
return(max(abs(difference)))
}
compute_statistic(Y_ki, W_k)
compute_statistic <- function(Y, W) {
Y1 = Y[W==1]
Y0 = Y[W==0]
Y1.star   = Y1 - mean(Y1)
Y0.star   = Y0 - mean(Y0)
unique.points = c(Y1.star, Y0.star)
Fn1 = ecdf(Y1.star)
Fn0 = ecdf(Y0.star)
difference = Fn1(unique.points) - Fn0(unique.points)
return(max(abs(difference)))
}
W_k <- rep(c(0,1),each=100)
Y_ki = 10*W_k + rnorm(100)
summary(lm(Y_ki ~ W_k))
W_k_b = sample(W_k)
mean(Y_ki[W_k==1]) - mean(Y_ki[W_k==0])
compute_statistic(Y_ki, W_k)
compute_statistic(Y_ki, W_k)
# obs difference is 10
Y_ki_b = Y_ki - 5*W_k + 5*W_k_b
mean(Y_ki_b[W_k_b==1]) - mean(Y_ki_b[W_k_b==0])
compute_statistic(Y_ki_b, W_k_b)
compute_statistic(Y_ki, W_k)
compute_statistic <- function(Y, W) {
Y1 = Y[W==1]
Y0 = Y[W==0]
Y1.star   = Y1 - mean(Y1)
Y0.star   = Y0 - mean(Y0)
unique.points = c(Y1.star, Y0.star)
Fn1 = ecdf(Y1.star)
Fn0 = ecdf(Y0.star)
difference = Fn1(unique.points) - Fn0(unique.points)
return(max(abs(difference)))
}
compute_statistic_2 <- function(Y, W, delta) {
Y1 = Y[W==1]
Y0 = Y[W==0]
Y1.star   = Y1 - delta
Y0.star   = Y0
unique.points = c(Y1.star, Y0.star)
Fn1 = ecdf(Y1.star)
Fn0 = ecdf(Y0.star)
difference = Fn1(unique.points) - Fn0(unique.points)
return(max(abs(difference)))
}
W_k <- rep(c(0,1),each=100)
Y_ki = 10*W_k + rnorm(100)
summary(lm(Y_ki ~ W_k))
W_k_b = sample(W_k)
mean(Y_ki[W_k==1]) - mean(Y_ki[W_k==0])
compute_statistic(Y_ki, W_k)
# obs difference is 10
Y_ki_b = Y_ki - 5*W_k + 5*W_k_b
mean(Y_ki_b[W_k_b==1]) - mean(Y_ki_b[W_k_b==0])
compute_statistic(Y_ki_b, W_k_b)
compute_statistic_2(Y_ki_b, W_k_b)
compute_statistic_2(Y_ki_b, W_k_b, 5)
compute_statistic(Y_ki_b, W_k_b)
compute_statistic_2(Y_ki_b, W_k_b, 5)
compute_statistic(Y_ki, W_k)
# obs difference is 10
Y_ki_b = Y_ki - 5*W_k + 5*W_k_b
mean(Y_ki_b[W_k_b==1]) - mean(Y_ki_b[W_k_b==0])
compute_statistic(Y_ki_b, W_k_b)
compute_statistic <- function(Y, W) {
Y1 = Y[W==1]
Y0 = Y[W==0]
Y1.star   = Y1 - mean(Y1)
Y0.star   = Y0 - mean(Y0)
unique.points = c(Y1.star, Y0.star)
Fn1 = ecdf(Y1.star)
Fn0 = ecdf(Y0.star)
difference = Fn1(unique.points) - Fn0(unique.points)
return(max(abs(difference)))
}
compute_statistic_2 <- function(Y, W, delta) {
Y1 = Y[W==1]
Y0 = Y[W==0]
Y1.star   = Y1 - delta
Y0.star   = Y0
unique.points = c(Y1.star, Y0.star)
Fn1 = ecdf(Y1.star)
Fn0 = ecdf(Y0.star)
difference = Fn1(unique.points) - Fn0(unique.points)
return(max(abs(difference)))
}
W_k <- rep(c(0,1),each=100)
Y_ki = 10*W_k + rnorm(100)
summary(lm(Y_ki ~ W_k))
W_k_b = sample(W_k)
mean(Y_ki[W_k==1]) - mean(Y_ki[W_k==0])
compute_statistic(Y_ki, W_k)
# obs difference is 10
Y_ki_b = Y_ki - 5*W_k + 5*W_k_b
mean(Y_ki_b[W_k_b==1]) - mean(Y_ki_b[W_k_b==0])
compute_statistic(Y_ki_b, W_k_b)
compute_statistic_2(Y_ki_b, W_k_b, 5)
compute_statistic <- function(Y, W) {
Y1 = Y[W==1]
Y0 = Y[W==0]
Y1.star   = Y1 - mean(Y1)
Y0.star   = Y0 - mean(Y0)
unique.points = c(Y1.star, Y0.star)
Fn1 = ecdf(Y1.star)
Fn0 = ecdf(Y0.star)
difference = Fn1(unique.points) - Fn0(unique.points)
return(max(abs(difference)))
}
compute_statistic_2 <- function(Y, W, delta) {
Y1 = Y[W==1]
Y0 = Y[W==0]
Y1.star   = Y1 - delta
Y0.star   = Y0
unique.points = c(Y1.star, Y0.star)
Fn1 = ecdf(Y1.star)
Fn0 = ecdf(Y0.star)
difference = Fn1(unique.points) - Fn0(unique.points)
return(max(abs(difference)))
}
W_k <- rep(c(0,1),each=100)
Y_ki = 10*W_k + rnorm(100)
summary(lm(Y_ki ~ W_k))
compute_statistic(Y_ki, W_k)
compute_statistic(Y_ki_b, W_k_b, 5)
compute_statistic <- function(Y, W) {
Y1 = Y[W==1]
Y0 = Y[W==0]
Y1.star   = Y1 - mean(Y1)
Y0.star   = Y0 - mean(Y0)
unique.points = c(Y1.star, Y0.star)
Fn1 = ecdf(Y1.star)
Fn0 = ecdf(Y0.star)
difference = Fn1(unique.points) - Fn0(unique.points)
return(max(abs(difference)))
}
compute_statistic_2 <- function(Y, W, delta) {
Y1 = Y[W==1]
Y0 = Y[W==0]
Y1.star   = Y1 - delta
Y0.star   = Y0
unique.points = c(Y1.star, Y0.star)
Fn1 = ecdf(Y1.star)
Fn0 = ecdf(Y0.star)
difference = Fn1(unique.points) - Fn0(unique.points)
return(max(abs(difference)))
}
W_k <- rep(c(0,1),each=100)
Y_ki = 10*W_k + rnorm(100)
summary(lm(Y_ki ~ W_k))
compute_statistic(Y_ki, W_k)
compute_statistic_2(Y_ki_b, W_k_b, 5)
compute_statistic <- function(Y, W) {
Y1 = Y[W==1]
Y0 = Y[W==0]
Y1.star   = Y1 - mean(Y1)
Y0.star   = Y0 - mean(Y0)
unique.points = c(Y1.star, Y0.star)
Fn1 = ecdf(Y1.star)
Fn0 = ecdf(Y0.star)
difference = Fn1(unique.points) - Fn0(unique.points)
return(max(abs(difference)))
}
compute_statistic_2 <- function(Y, W, delta) {
Y1 = Y[W==1]
Y0 = Y[W==0]
Y1.star   = Y1 - delta
Y0.star   = Y0
unique.points = c(Y1.star, Y0.star)
Fn1 = ecdf(Y1.star)
Fn0 = ecdf(Y0.star)
difference = Fn1(unique.points) - Fn0(unique.points)
return(max(abs(difference)))
}
W_k <- rep(c(0,1),each=100)
Y_ki = 10*W_k + rnorm(100)
summary(lm(Y_ki ~ W_k))
compute_statistic(Y_ki, W_k)
compute_statistic_2(Y_ki_b, W_k_b, 5)
compute_statistic <- function(Y, W) {
Y1 = Y[W==1]
Y0 = Y[W==0]
Y1.star   = Y1 - mean(Y1)
Y0.star   = Y0 - mean(Y0)
unique.points = c(Y1.star, Y0.star)
Fn1 = ecdf(Y1.star)
Fn0 = ecdf(Y0.star)
difference = Fn1(unique.points) - Fn0(unique.points)
return(max(abs(difference)))
}
compute_statistic_2 <- function(Y, W, delta) {
Y1 = Y[W==1]
Y0 = Y[W==0]
Y1.star   = Y1 - delta
Y0.star   = Y0
unique.points = c(Y1.star, Y0.star)
Fn1 = ecdf(Y1.star)
Fn0 = ecdf(Y0.star)
difference = Fn1(unique.points) - Fn0(unique.points)
return(max(abs(difference)))
}
W_k <- rep(c(0,1),each=100)
Y_ki = 10*W_k + rnorm(100)
summary(lm(Y_ki ~ W_k))
compute_statistic(Y_ki, W_k)
compute_statistic_2(Y_ki_b, W_k_b, 5)
test_stat_1 = function() {
W_k_b = sample(W_k)
Y_ki_b = Y_ki - 5*W_k + 5*W_k_b
return(c(compute_statistic(Y_ki_b, W_k_b),
compute_statistic_2(Y_ki_b, W_k_b, 5)
))
}
apply(1:100,1,test_stat_1)
?replicate
replicate(1:100,test_stat_1)
replicate(100,test_stat_1)
replicate(100,test_stat_1())
compute_statistic <- function(Y, W) {
Y1 = Y[W==1]
Y0 = Y[W==0]
Y1.star   = Y1 - mean(Y1)
Y0.star   = Y0 - mean(Y0)
unique.points = c(Y1.star, Y0.star)
Fn1 = ecdf(Y1.star)
Fn0 = ecdf(Y0.star)
difference = Fn1(unique.points) - Fn0(unique.points)
return(max(abs(difference)))
}
compute_statistic_2 <- function(Y, W, delta) {
Y1 = Y[W==1]
Y0 = Y[W==0]
Y1.star   = Y1 - delta
Y0.star   = Y0
unique.points = c(Y1.star, Y0.star)
Fn1 = ecdf(Y1.star)
Fn0 = ecdf(Y0.star)
difference = Fn1(unique.points) - Fn0(unique.points)
return(max(abs(difference)))
}
W_k <- rep(c(0,1),each=100)
Y_ki = 10*W_k + rnorm(100)
summary(lm(Y_ki ~ W_k))
test_stat_1 = function() {
W_k_b = sample(W_k)
Y_ki_b = Y_ki - 5*W_k + 5*W_k_b
return(c(compute_statistic(Y_ki_b, W_k_b),
compute_statistic_2(Y_ki_b, W_k_b, 5)
))
}
perm_dist = replicate(100,test_stat_1())
compute_statistic(Y_ki, W_k)
perm_dist[,1]
compute_statistic_2(Y_ki_b, W_k_b, 5)
perm_dist[,2]
perm_dist[1,]
compute_statistic(Y_ki, W_k)
compute_statistic_2(Y_ki_b, W_k_b, 5)
perm_dist[2,]
length(compute_statistic(Y_ki, W_k) >= perm_dist[1,])/100
compute_statistic(Y_ki, W_k)
compute_statistic(Y_ki, W_k) >= perm_dist[1,]
sum(compute_statistic(Y_ki, W_k) >= perm_dist[1,])/100
W_k <- rep(c(0,1),each=100)
Y_ki = 5*W_k + rnorm(100)
summary(lm(Y_ki ~ W_k))
test_stat_1 = function() {
W_k_b = sample(W_k)
Y_ki_b = Y_ki - 5*W_k + 5*W_k_b
return(c(compute_statistic(Y_ki_b, W_k_b),
compute_statistic_2(Y_ki_b, W_k_b, 5)
))
}
perm_dist = replicate(100,test_stat_1())
compute_statistic(Y_ki, W_k)
sum(compute_statistic(Y_ki, W_k) >= perm_dist[1,])/100
compute_statistic_2(Y_ki_b, W_k_b, 5)
perm_dist[2,]
sum(compute_statistic_2(Y_ki_b, W_k_b, 5) >= perm_dist[2,])
perm_dist = replicate(100,test_stat_1())
compute_statistic(Y_ki, W_k)
sum(compute_statistic(Y_ki, W_k) >= perm_dist[1,])/100
compute_statistic_2(Y_ki_b, W_k_b, 5)
perm_dist[2,]
sum(compute_statistic_2(Y_ki_b, W_k_b, 5) >= perm_dist[2,])/100
compute_statistic <- function(Y, W) {
Y1 = Y[W==1]
Y0 = Y[W==0]
Y1.star   = Y1 - mean(Y1)
Y0.star   = Y0 - mean(Y0)
unique.points = c(Y1.star, Y0.star)
Fn1 = ecdf(Y1.star)
Fn0 = ecdf(Y0.star)
difference = Fn1(unique.points) - Fn0(unique.points)
return(max(abs(difference)))
}
compute_statistic_2 <- function(Y, W, delta) {
Y1 = Y[W==1]
Y0 = Y[W==0]
Y1.star   = Y1 - delta
Y0.star   = Y0
unique.points = c(Y1.star, Y0.star)
Fn1 = ecdf(Y1.star)
Fn0 = ecdf(Y0.star)
difference = Fn1(unique.points) - Fn0(unique.points)
return(max(abs(difference)))
}
W_k <- rep(c(0,1),each=100)
Y_ki = 5*W_k + rnorm(100)
summary(lm(Y_ki ~ W_k))
test_stat_1 = function() {
W_k_b = sample(W_k)
Y_ki_b = Y_ki - 5*W_k + 5*W_k_b
return(c(compute_statistic(Y_ki_b, W_k_b),
compute_statistic_2(Y_ki_b, W_k_b, 5)
))
}
perm_dist = replicate(100,test_stat_1())
compute_statistic(Y_ki, W_k)
sum(compute_statistic(Y_ki, W_k) >= perm_dist[1,])/100
perm_dist[1,]
perm_dist = replicate(100,test_stat_1())
compute_statistic(Y_ki, W_k)
sum(compute_statistic(Y_ki, W_k) <= perm_dist[1,])/100
compute_statistic_2(Y_ki_b, W_k_b, 5)
perm_dist[2,]
sum(compute_statistic_2(Y_ki_b, W_k_b, 5) <= perm_dist[2,])/100
sum(compute_statistic(Y_ki, W_k) <= perm_dist[1,])/100
sum(compute_statistic_2(Y_ki_b, W_k_b, 5) <= perm_dist[2,])/100
Y_ki = 100*W_k + rnorm(100)
summary(lm(Y_ki ~ W_k))
test_stat_1 = function() {
W_k_b = sample(W_k)
Y_ki_b = Y_ki - 5*W_k + 5*W_k_b
return(c(compute_statistic(Y_ki_b, W_k_b),
compute_statistic_2(Y_ki_b, W_k_b, 5)
))
}
perm_dist = replicate(100,test_stat_1())
compute_statistic(Y_ki, W_k)
sum(compute_statistic(Y_ki, W_k) <= perm_dist[1,])/100
compute_statistic_2(Y_ki_b, W_k_b, 5)
sum(compute_statistic_2(Y_ki_b, W_k_b, 5) <= perm_dist[2,])/100
W_k <- rep(c(0,1),each=100)
Y_ki = 100*W_k + rnorm(200)
summary(lm(Y_ki ~ W_k))
test_stat_1 = function() {
W_k_b = sample(W_k)
Y_ki_b = Y_ki - 5*W_k + 5*W_k_b
return(c(compute_statistic(Y_ki_b, W_k_b),
compute_statistic_2(Y_ki_b, W_k_b, 5)
))
}
perm_dist = replicate(100,test_stat_1())
compute_statistic(Y_ki, W_k)
sum(compute_statistic(Y_ki, W_k) <= perm_dist[1,])/100
compute_statistic_2(Y_ki_b, W_k_b, 5)
sum(compute_statistic_2(Y_ki_b, W_k_b, 5) <= perm_dist[2,])/100
compute_statistic(Y_ki, W_k)
compute_statistic_2(Y_ki_b, W_k_b, 5)
compute_statistic_2(Y_ki_b, W_k_b, 5)
compute_statistic(Y_ki, W_k)
W_k <- rep(c(0,1),each=100)
Y_ki = 100*W_k + rnorm(200)
summary(lm(Y_ki ~ W_k))
test_stat_1 = function() {
W_k_b = sample(W_k)
Y_ki_b = Y_ki - 5*W_k + 5*W_k_b
return(c(compute_statistic(Y_ki_b, W_k_b),
compute_statistic_2(Y_ki_b, W_k_b, 5)
))
}
compute_statistic(Y_ki, W_k)
compute_statistic_2(Y_ki_b, W_k_b, 5)
perm_dist = replicate(100,test_stat_1())
compute_statistic(Y_ki, W_k)
compute_statistic_2(Y_ki, W_k, 5)
sum(compute_statistic(Y_ki, W_k) <= perm_dist[1,])/100
compute_statistic_2(Y_ki, W_k, 5)
sum(compute_statistic_2(Y_ki, W_k, 5) <= perm_dist[2,])/100
compute_statistic_2(Y_ki, W_k, 5)
Y_ki = 10*W_k + rnorm(200)
summary(lm(Y_ki ~ W_k))
test_stat_1 = function() {
W_k_b = sample(W_k)
Y_ki_b = Y_ki - 5*W_k + 5*W_k_b
return(c(compute_statistic(Y_ki_b, W_k_b),
compute_statistic_2(Y_ki_b, W_k_b, 5)
))
}
perm_dist = replicate(100,test_stat_1())
compute_statistic(Y_ki, W_k)
compute_statistic_2(Y_ki, W_k, 5)
compute_statistic(Y_ki, W_k)
compute_statistic_2(Y_ki, W_k, 5)
perm_dist = replicate(100,test_stat_1())
perm_dist[1,]
perm_dist[2,]
compute_statistic_2(Y_ki, W_k, 5)
compute_statistic(Y_ki, W_k)
perm_dist[1,]
compute_statistic_2(Y_ki, W_k, 5)
sum(compute_statistic_2(Y_ki, W_k, 5) <= perm_dist[2,])/100
perm_dist[2,]
compute_statistic_2(Y_ki, W_k, 5)
sum(compute_statistic_2(Y_ki, W_k, 5) <= perm_dist[2,])/100
test_stat_1 = function() {
W_k_b = sample(W_k)
Y_ki_b = Y_ki - 5*W_k + 5*W_k_b
return(c(compute_statistic(Y_ki_b, W_k_b),
compute_statistic_2(Y_ki_b, W_k_b, 5)
))
}
perm_dist = replicate(100,test_stat_1())
# scaling by estimated delta
compute_statistic(Y_ki, W_k)
sum(compute_statistic(Y_ki, W_k) <= perm_dist[1,])/100
perm_dist[1,]
# scaling by estimated delta
compute_statistic(Y_ki, W_k)
# Using wrong delta, creates
# H_0: diff is 5
# No, difference is 10!
compute_statistic_2(Y_ki, W_k, 5)
sum(compute_statistic_2(Y_ki, W_k, 5) <= perm_dist[2,])/100
# Using wrong delta, creates
# H_0: diff is 5
# No, difference is 10!
compute_statistic_2(Y_ki, W_k, 100)
sum(compute_statistic_2(Y_ki, W_k, 100) <= perm_dist[2,])/100
sum(compute_statistic(Y_ki, W_k) <= perm_dist[1,])/100
# Using wrong delta, creates
# H_0: diff is 5
# No, difference is 10!
compute_statistic_2(Y_ki, W_k, 100)
compute_statistic_2 <- function(Y, W, delta) {
Y1 = Y[W==1]
Y0 = Y[W==0]
Y1.star   = Y1
Y0.star   = Y0 - delta
unique.points = c(Y1.star, Y0.star)
Fn1 = ecdf(Y1.star)
Fn0 = ecdf(Y0.star)
difference = Fn1(unique.points) - Fn0(unique.points)
return(max(abs(difference)))
}
# Using wrong delta, creates
# H_0: diff is 5
# No, difference is 10!
compute_statistic_2(Y_ki, W_k, 100)
mean(Y_ki[W_k==1])
mean(Y_ki[W_k==0])
# Using wrong delta, creates
# H_0: diff is 5
# No, difference is 10!
compute_statistic_2(Y_ki, W_k, 10)
compute_statistic <- function(Y, W) {
Y1 = Y[W==1]
Y0 = Y[W==0]
Y1.star   = Y1 - mean(Y1)
Y0.star   = Y0 - mean(Y0)
unique.points = c(Y1.star, Y0.star)
Fn1 = ecdf(Y1.star)
Fn0 = ecdf(Y0.star)
difference = Fn1(unique.points) - Fn0(unique.points)
return(max(abs(difference)))
}
compute_statistic_2 <- function(Y, W, delta) {
Y1 = Y[W==1]
Y0 = Y[W==0]
Y1.star   = Y1 - delta
Y0.star   = Y0
unique.points = c(Y1.star, Y0.star)
Fn1 = ecdf(Y1.star)
Fn0 = ecdf(Y0.star)
difference = Fn1(unique.points) - Fn0(unique.points)
return(max(abs(difference)))
}
# Using wrong delta, creates
# H_0: diff is 5
# No, difference is 10!
compute_statistic_2(Y_ki, W_k, 10)
# scaling by estimated delta
compute_statistic(Y_ki, W_k)
sum(compute_statistic_2(Y_ki, W_k, 10) <= perm_dist[2,])/100
perm_dist = replicate(100,test_stat_1())
# scaling by estimated delta
compute_statistic(Y_ki, W_k)
sum(compute_statistic(Y_ki, W_k) <= perm_dist[1,])/100
